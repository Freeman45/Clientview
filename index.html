<!DOCTYPE html>
<html>
<head><title>Customer Contact</title></head>
<body>
    <h2>Message Us</h2>
    <div id="formSection">
        <input type="text" id="alias" placeholder="Your Name"><br>
        <textarea id="msg" placeholder="How can we help?"></textarea><br>
        <button onclick="sendMsg()">Send Message</button>
    </div>

    <div id="statusSection" style="display:none; border:1px solid #ccc; padding:10px; margin-top:10px;">
        <p><strong>Message ID:</strong> <span id="displayId"></span></p>
        <p><strong>Your Message:</strong> <span id="displayMsg"></span></p>
        <p><strong>Admin Reply:</strong> <span id="replyText" style="color:blue;">Waiting for admin...</span></p>
    </div>

    <script>
        const API = "YOUR_WEB_APP_URL"; // PASTE YOUR URL HERE
        let currentId = null;

        async function sendMsg() {
            currentId = "msg_" + Date.now() + "_" + Math.floor(Math.random()*1000);
            const data = {
                action: "addMessage",
                messageId: currentId,
                alias: document.getElementById('alias').value,
                message: document.getElementById('msg').value
            };

            await fetch(API, { method: "POST", body: JSON.stringify(data) });
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('statusSection').style.display = 'block';
            document.getElementById('displayId').innerText = currentId;
            document.getElementById('displayMsg').innerText = data.message;
            
            setInterval(checkReply, 5000); // Poll every 5s
        }

        async function checkReply() {
            const res = await fetch(`${API}?messageId=${currentId}`);
            const json = await res.json();
            if (json.length > 0 && json[0].reply) {
                document.getElementById('replyText').innerText = json[0].reply;
                document.getElementById('replyText').style.color = "green";
            }
        }
    </script>
</body>
</html>
