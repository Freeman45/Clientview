<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Client Review Page</title>
<style>
body { font-family: Arial, sans-serif; background: #111; color: #fff; display: flex; justify-content: center; align-items: center; height: 100vh; }
.container { background: #1a1a1a; padding: 30px; border-radius: 10px; width: 400px; text-align: center; }
input, textarea, button { width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 5px; border: 1px solid #bc13fe; background: #222; color: #fff; }
button { cursor: pointer; background: #bc13fe; border: none; }
#replyDisplay { margin-top: 15px; color: #ffcc00; font-weight: bold; }
</style>
</head>
<body>
<div class="container">
<h2>Send a Message</h2>
<input type="text" id="alias" placeholder="Your Name (Alias)">
<textarea id="message" placeholder="Type your message..." rows="4"></textarea>
<button onclick="sendMessage()">Send Message</button>
<p id="replyDisplay">Reply will appear here if available</p>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyvD5r3LE94iIFVUI8A9l_IaH-oLL7DXxirpKlQ1Ba4jIb0Lz6rdV649Cevzl4wd2UR/exec";

function generateId() {
  return 'msg_' + Date.now() + '_' + Math.floor(Math.random()*1000);
}

async function sendMessage() {
  const alias = document.getElementById('alias').value.trim();
  const message = document.getElementById('message').value.trim();
  if(!alias || !message){ alert("Fill both fields"); return; }

  const messageId = generateId();

  // POST message
  await fetch(WEB_APP_URL, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams({ messageId, alias, message })
  });

  document.getElementById('message').value = "";
  alert("Message sent! Your unique ID: " + messageId);

  // Poll for reply every 5 seconds
  const replyDisplay = document.getElementById('replyDisplay');
  const interval = setInterval(async () => {
    const res = await fetch(WEB_APP_URL + "?messageId=" + messageId);
    const data = await res.json();
    if(data.Reply && data.Reply !== ""){
      replyDisplay.textContent = "Reply: " + data.Reply;
      clearInterval(interval);
    }
  }, 5000);
}
</script>
</body>
</html>
